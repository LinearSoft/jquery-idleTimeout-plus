!function(t,o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof exports?module.exports=o(require("jquery")):t.IdleTimeoutPlus=o(t.jQuery)}(this,function(t){function o(t,o){O.multiWindowSupport?G.set(t,o):G[t]=o}function n(t,o){if(o="undefined"!=typeof o?o:null,O.multiWindowSupport){if(G.isSet(t))return G.get(t)}else if(t in G)return G[t];return o}function e(){o("warningStartTime",-1),o("lockStartTime",-1),l(),O.idleCallback!==!1&&O.idleCallback(O)}function l(){a(),o("lastActivity",$.now()),z=setInterval(i,O.idleCheckHeartbeat)}function a(){clearInterval(z)}function i(){var t=n("lastActivity",$.now())+O.idleTimeLimit;return n("logoutTriggered")===!0?Y():$.now()>=t?(a(),O.warnEnabled?s():O.lockEnabled?S():D()):void 0}function r(){$(document).on(O.activityEvents,function(t){if("mousemove"===t.type){if(t.clientX===Z[0]&&t.clientY===Z[1])return;Z[0]=t.clientX,Z[1]=t.clientY}-1==n("warningStartTime",-1)&&-1==n("lockStartTime",-1)&&l()})}function c(){u(),F=setInterval(function(){$.ajax({type:O.keepAliveAjaxType,url:O.keepAliveUrl,data:O.keepAliveAjaxData})},O.keepAliveInterval)}function u(){clearInterval(F)}function s(){p(),O.warnCallback!==!1&&(_=O.warnCallback(O)),w()}function d(){k(),v(),o("warningStartTime",-1),e()}function p(){o("warningStartTime",$.now()),R=setInterval(f,500)}function k(){clearInterval(R)}function f(){if(n("logoutTriggered")===!0)return k(),Y();if(-1==n("warningStartTime",-1))return d();var t=n("warningStartTime")+O.warnTimeLimit-1;return $.now()>=t?(k(),O.lockEnabled?(v(),S()):D()):void b()}function w(){_&&(m(),b(),O.bootstrap?ot.modal("show"):ot.dialog("open"),tt=!0)}function v(){tt=!1,null!==ot&&(O.bootstrap?(ot.modal("hide"),X.removeClass("modal-open"),$("div.modal-backdrop").remove()):ot.dialog("close"))}function b(){if(null!==ot&&(null!==nt||null!==et)){var t=$.now(),o=Math.floor((n("warningStartTime",t)+O.warnTimeLimit-t)/1e3);if(null!==nt&&nt.html(N(o)),null!=et){var e=Math.floor(o/(O.warnTimeLimit/1e3)*100);O.bootstrap?et.css("width",e+"%"):et.progressbar("value",e)}}}function m(){if(null===ot){var t="";t=O.warnContentCallback!==!1?O.warnContentCallback(O):O.bootstrap?C():j(),O.bootstrap?g(t):y(t)}}function g(t){X.append(t),$("#jitp-warn-logout").on("click",function(){h()}),$("#jitp-warn-alive").on("click",function(){T()}),ot=$("#jitp-warn-display"),(0!=O.warnCountdownMessage||O.warnCountdownBar)&&(nt=ot.find(".jitp-countdown-holder")),O.warnCountdownBar&&(et=$("#jitp-warn-bar"))}function y(t){$(t).dialog({buttons:[{text:O.warnLogoutButton,click:function(){h()}},{text:O.warnStayAliveButton,click:function(){T()}}],closeOnEscape:!1,modal:!0,title:O.warnTitle,minWidth:320,autoOpen:!1,open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide(),$(this).parent().find("button:nth-child(2)").focus()}}),ot=$("#jitp-warn-display"),0!=O.warnCountdownMessage&&(nt=ot.find(".jitp-countdown-holder")),O.warnCountdownBar&&(et=$("#jitp-warn-bar"),et.progressbar({value:0,max:100}))}function C(){var t=O.warnCountdownMessage?"<p>"+O.warnCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>":"",o=O.warnCountdownBar?'<div class="progress">               <div id="jitp-warn-bar" class="progress-bar progress-bar-striped active" role="progressbar" style="min-width: 15px; width: 100%;">                 <span class="jitp-countdown-holder"></span>               </div>             </div>':"";return'<div class="modal fade" id="jitp-warn-display" data-backdrop="static" data-keyboard="false">                 <div class="modal-dialog">                     <div class="modal-content">                         <div class="modal-header">                             <h4 class="modal-title">'+O.warnTitle+'</h4>                         </div>                         <div class="modal-body">                             <p>'+O.warnMessage+"</p>                             "+t+"                             "+o+'                         </div>                         <div class="modal-footer">                             <button id="jitp-warn-logout" type="button" class="btn btn-default">'+O.warnLogoutButton+'</button>                             <button id="jitp-warn-alive" type="button" class="btn btn-primary">'+O.warnStayAliveButton+"</button>                         </div>                     </div>                 </div>             </div>"}function j(){var t=O.warnCountdownMessage?"<p>"+O.warnCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>":"",o=O.warnCountdownBar?'<div id="jitp-warn-bar"></div>':"";return'<div id="jitp-warn-display"><p>'+O.warnMessage+"</p>"+t+o+"</div>"}function h(){k(),K()}function T(){d()}function S(){O.lockHaltKeepAlive&&u(),M(),O.lockCallback!==!1&&(lt=O.lockCallback(O)),I()}function A(){O.lockHaltKeepAlive&&u(),V=setInterval(L,500),I()}function U(){B(),x(),O.keepAliveInterval&&c(),o("lockStartTime",-1),e()}function M(){o("lockStartTime",$.now()),V=setInterval(L,500)}function B(){clearInterval(V)}function L(){if(n("logoutTriggered")===!0)return B(),Y();if(-1==n("lockStartTime",-1))return U();var t=n("lockStartTime")+O.lockTimeLimit-1;return $.now()>=t?(B(),D()):void E()}function I(){if(lt){q(),E();var t={message:$("#jitp-lock-display")};t=$.extend(t,O.lockBlockUiConfig),$.blockUI(t),at=!0}}function x(){$.unblockUI(),at=!1}function E(){if(null!==rt){var t=$.now(),o=Math.floor((n("lockStartTime",t)+O.lockTimeLimit-t)/1e3);rt.html(N(o))}}function q(){if(null===it){var t="";t=O.lockContentCallback!==!1?O.lockContentCallback(O):O.bootstrap?P():W(),X.append(t),it=$("#jitp-lock-display"),0!=O.lockCountdownMessage&&(rt=it.find(".jitp-countdown-holder")),$("#jitp-lock-logout").on("click",function(){H()}),$("#jitp-lock-unlock").on("click",function(){Q()}),E()}}function P(){var t=null!==O.lockTitle?'<div class="panel-heading"><h2 class="panel-title">'+O.lockTitle+"</h2></div>":"",o=O.lockLogoutButton.replace(/{username}/g,O.lockUsername),n=O.lockCountdownMessage?'<div class="panel-footer">'+O.lockCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder">BUBBA</span>')+"</div>":"";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;">             <div class="panel panel-default jitp-lock-panel">                 '+t+'                 <div class="panel-body">                     <h4>'+O.lockUsername+"</h4>                     <p>"+O.lockMessage+'</p>                     <div class="input-group">                         <input id="jitp-lock-pass" type="text" class="form-control" placeholder="Password..."/>                         <span class="input-group-btn">                             <button id="jitp-lock-unlock" class="btn btn-primary" type="button">'+O.lockUnlockButton+'</button>                         </span>                     </div>                     <a id="jitp-lock-logout" href="javascript:;">'+o+"</a>                 </div>                 "+n+"            </div>            </div>"}function W(){var t=null!==O.lockTitle?"<header>"+O.lockTitle+"</header>":"",o=O.lockLogoutButton.replace(/{username}/g,O.lockUsername),n=O.lockCountdownMessage?"<footer>"+O.lockCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</footer>":"";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;">             <div class="jitp-lock-panel jitp-lock-jqpanel">                 '+t+'                 <div class="jitp-lock-jqpanel-body">                     <h2>'+O.lockUsername+"</h2>                     <p>"+O.lockMessage+'</p>                     <div>                         <input id="jitp-lock-pass" type="text" class="form-control" placeholder="Password..."/>                     </div>                     <button id="jitp-lock-unlock" type="button">'+O.lockUnlockButton+'</button>                     <a id="jitp-lock-logout" href="javascript:;">'+o+"</a>                 </div>                 "+n+"            </div>            </div>"}function H(){B(),K()}function Q(){O.lockPassCallback($("#jitp-lock-pass").val())&&U()}function K(){o("logoutTriggered",!0),("function"!=typeof O.logoutCallback||O.logoutCallback(O))&&(window.location=O.logoutUrl)}function Y(){("function"!=typeof O.logoutAutoCallback||O.logoutAutoCallback(O))&&(window.location=O.logoutAutoUrl)}function D(){("function"!=typeof O.redirectCallback||O.redirectCallback(O))&&(window.location.href=O.redirectUrl)}function N(t){var o=Math.floor(t/60);if(15>=o){var n=t%60,e=o>0?o+"m ":"";return e+=n+"s"}if(75>=o)return 22>=o?"about 15 mins":37>=o?"about 30 mins":52>=o?"about 25 mins":"about 1 hour";var l=Math.floor(o/60);return o%=60,15>=o||o>52?"about "+l+" hours":"about "+l+"&frac12; hours"}var O={idleTimeLimit:1200,idleCallback:!1,idleCheckHeartbeat:2,activityEvents:"click keypress scroll wheel mousewheel mousemove touchmove",bootstrap:!1,warnEnabled:!0,warnTimeLimit:180,warnCallback:!1,warnContentCallback:!1,warnTitle:"Session Timeout",warnMessage:"Your session is about to expire!",warnStayAliveButton:"Stay Connected",warnLogoutButton:"Logout",warnCountdownMessage:"Time remaining: {timer}",warnCountdownBar:!1,lockEnabled:!1,lockTimeLimit:7200,lockHaltKeepAlive:!0,lockCallback:!1,lockContentCallback:!1,lockPassCallback:!1,lockTitle:null,lockUsername:"System User",lockMessage:"Enter your password to unlock the screen",lockUnlockButton:"UnLock",lockLogoutButton:"Not {username} ?",lockCountdownMessage:"Auto-logout in: {timer}",lockBlockUiConfig:{},redirectUrl:"/timed-out",redirectCallback:!1,logoutUrl:"/logout",logoutCallback:!1,logoutAutoUrl:"/logout-notice",logoutAutoCallback:!1,keepAliveInterval:600,keepAliveUrl:window.location.href,keepAliveAjaxType:"GET",keepAliveAjaxData:"",multiWindowSupport:!0},X=$("body"),G=null,J={};J.start=function(t){if(O=$.extend(O,t),O.idleTimeLimit*=1e3,O.idleCheckHeartbeat*=1e3,O.warnTimeLimit*=1e3,O.lockTimeLimit*=1e3,O.keepAliveInterval*=1e3,O.multiWindowSupport&&!$.localStorage)return console.error("jitp: Multi-Window support requested but JQuery Storage API is unavailable"),!1;if(O.warnEnabled&&O.warnCallback===!1||O.lockEnabled&&O.lockCallback===!1)if(O.bootstrap){if("undefined"==typeof $.fn.modal)return console.error("jitp: Bootstrap library is unavailable"),!1}else if("undefined"==typeof jQuery.ui)return console.error("jitp: jQueryUI library is unavailable"),!1;if(O.lockEnabled&&O.lockCallback===!1){if("undefined"==typeof $.blockUI)return console.error("jitp: Lock screen requested but blockUI library is unavailable"),!1;if(O.lockPassCallback===!1)return console.error("jitp: Lock screen requested but lockPassCallback function is not set"),!1}return G=O.multiWindowSupport?$.initNamespaceStorage("jqueryIdleTimeoutPlus").localStorage:{},O.keepAliveInterval&&c(),r(),O.lockEnabled&&-1!=n("lockStartTime",-1)?A():(o("logoutTriggered",!1),o("warningStartTime",-1),o("lockStartTime",-1),o("lastActivity",$.now()),l()),!0},J.logout=function(){K()},J.displayWarning=function(){w()},J.displayLockScreen=function(){I()},J.rollback=function(){U(),d()};var z,F,R,V,Z=[-1,-1],_=!0,tt=!1,ot=null,nt=null,et=null,lt=!0,at=!1,it=null,rt=null;return J});
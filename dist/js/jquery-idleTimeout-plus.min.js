!function(t,o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof exports?module.exports=o(require("jquery")):t.IdleTimeoutPlus=o(t.jQuery)}(this,function(t){function o(t,o){X.multiWindowSupport?J.set(t,o):J[t]=o}function n(t,o){if(o="undefined"!=typeof o?o:null,X.multiWindowSupport){if(J.isSet(t))return J.get(t)}else if(t in J)return J[t];return o}function e(){o("warningStartTime",-1),o("lockStartTime",-1),l(),X.idleCallback!==!1&&X.idleCallback(X)}function l(){a(),o("lastActivity",$.now()),F=setInterval(i,X.idleCheckHeartbeat)}function a(){clearInterval(F)}function i(){var t=n("lastActivity",$.now())+X.idleTimeLimit;return n("logoutTriggered")===!0?D():-1!=n("lockStartTime",-1)?(a(),A()):$.now()>=t?(a(),X.warnEnabled?s():X.lockEnabled?S():N()):void 0}function r(){$(document).on(X.activityEvents,function(t){if("mousemove"===t.type){if(t.clientX===_[0]&&t.clientY===_[1])return;_[0]=t.clientX,_[1]=t.clientY}-1==n("warningStartTime",-1)&&-1==n("lockStartTime",-1)&&l()})}function c(){u(),R=setInterval(function(){$.ajax({type:X.keepAliveAjaxType,url:X.keepAliveUrl,data:X.keepAliveAjaxData})},X.keepAliveInterval)}function u(){clearInterval(R)}function s(){p(),X.warnCallback!==!1&&(tt=X.warnCallback(X)),v()}function d(){k(),w(),o("warningStartTime",-1),e()}function p(){o("warningStartTime",$.now()),V=setInterval(f,500)}function k(){clearInterval(V)}function f(){if(n("logoutTriggered")===!0)return k(),D();if(-1==n("warningStartTime",-1))return d();var t=n("warningStartTime")+X.warnTimeLimit-1;return $.now()>=t?(k(),X.lockEnabled?(w(),S()):N()):void b()}function v(){tt&&(m(),b(),X.bootstrap?nt.modal("show"):nt.dialog("open"),ot=!0)}function w(){ot=!1,null!==nt&&(X.bootstrap?(nt.modal("hide"),G.removeClass("modal-open"),$("div.modal-backdrop").remove()):nt.dialog("close"))}function b(){if(null!==nt&&(null!==et||null!==lt)){var t=$.now(),o=Math.floor((n("warningStartTime",t)+X.warnTimeLimit-t)/1e3);if(null!==et&&et.html(O(o)),null!=lt){var e=Math.floor(o/(X.warnTimeLimit/1e3)*100);X.bootstrap?lt.css("width",e+"%"):lt.progressbar("value",e)}}}function m(){if(null===nt){var t="";t=X.warnContentCallback!==!1?X.warnContentCallback(X):X.bootstrap?C():j(),X.bootstrap?g(t):y(t)}}function g(t){G.append(t),$("#jitp-warn-logout").on("click",function(){h()}),$("#jitp-warn-alive").on("click",function(){T()}),nt=$("#jitp-warn-display"),(0!=X.warnCountdownMessage||X.warnCountdownBar)&&(et=nt.find(".jitp-countdown-holder")),X.warnCountdownBar&&(lt=$("#jitp-warn-bar"))}function y(t){$(t).dialog({buttons:[{text:X.warnLogoutButton,click:function(){h()}},{text:X.warnStayAliveButton,click:function(){T()}}],closeOnEscape:!1,modal:!0,title:X.warnTitle,minWidth:320,autoOpen:!1,open:function(){null==X.warnTitle?$(this).closest(".ui-dialog").find(".ui-dialog-titlebar").hide():$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide(),$(this).parent().find("button:nth-child(2)").focus()}}),nt=$("#jitp-warn-display"),0!=X.warnCountdownMessage&&(et=nt.find(".jitp-countdown-holder")),X.warnCountdownBar&&(lt=$("#jitp-warn-bar"),lt.progressbar({value:0,max:100}))}function C(){var t=X.warnTitle?'<div class="modal-header"><h4 class="modal-title">'+X.warnTitle+"</h4></div>":"",o=X.warnCountdownMessage?"<p>"+X.warnCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>":"",n=X.warnCountdownBar?'<div class="progress">               <div id="jitp-warn-bar" class="progress-bar progress-bar-striped active" role="progressbar" style="min-width: 15px; width: 100%;">                 <span class="jitp-countdown-holder"></span>               </div>             </div>':"";return'<div class="modal fade" id="jitp-warn-display" data-backdrop="static" data-keyboard="false">                 <div class="modal-dialog">                     <div class="modal-content">                          '+t+'                         <div class="modal-body">                             <p>'+X.warnMessage+"</p>                             "+o+"                             "+n+'                         </div>                         <div class="modal-footer">                             <button id="jitp-warn-logout" type="button" class="btn btn-default">'+X.warnLogoutButton+'</button>                             <button id="jitp-warn-alive" type="button" class="btn btn-primary">'+X.warnStayAliveButton+"</button>                         </div>                     </div>                 </div>             </div>"}function j(){var t=X.warnCountdownMessage?"<p>"+X.warnCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>":"",o=X.warnCountdownBar?'<div id="jitp-warn-bar"></div>':"";return'<div id="jitp-warn-display"><p>'+X.warnMessage+"</p>"+t+o+"</div>"}function h(){k(),Y()}function T(){d()}function S(){X.lockHaltKeepAlive&&u(),U(),X.lockCallback!==!1&&(at=X.lockCallback(X)),I()}function A(){X.lockHaltKeepAlive?u():X.keepAliveInterval&&c(),-1==n("lockStartTime",-1)?U():Z=setInterval(B,500),I()}function L(){M(),x(),X.keepAliveInterval&&c(),o("lockStartTime",-1),e()}function U(){o("lockStartTime",$.now()),Z=setInterval(B,500)}function M(){clearInterval(Z)}function B(){if(1==n("logoutTriggered"))return M(),D();if(-1==n("lockStartTime",-1))return L();var t=n("lockStartTime")+X.lockTimeLimit-1;return $.now()>=t?(M(),1==n("logoutTriggered")?D():N()):void E()}function I(){if(at){q(),E();var t={message:$("#jitp-lock-display")};t=$.extend(t,X.lockBlockUiConfig),$.blockUI(t),it=!0}}function x(){$.unblockUI(),it=!1}function E(){if(null!==ct){var t=$.now(),o=Math.floor((n("lockStartTime",t)+X.lockTimeLimit-t)/1e3);ct.html(O(o))}}function q(){if(null===rt){var t="";t=X.lockContentCallback!==!1?X.lockContentCallback(X):X.bootstrap?P():W(),G.append(t),rt=$("#jitp-lock-display"),0!=X.lockCountdownMessage&&(ct=rt.find(".jitp-countdown-holder")),$("#jitp-lock-logout").on("click",function(){H()}),$("#jitp-lock-unlock").on("click",function(){Q()}),$("#jitp-lock-form").length&&$("#jitp-lock-form").submit(function(){return Q(),!1}),E()}}function P(){var t=null!==X.lockTitle?'<div class="panel-heading"><h2 class="panel-title">'+X.lockTitle+"</h2></div>":"",o=X.lockLogoutButton.replace(/{username}/g,X.lockUsername),n=X.lockCountdownMessage?'<div class="panel-footer">'+X.lockCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder">BUBBA</span>')+"</div>":"";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;">             <div class="panel panel-default jitp-lock-panel">                 '+t+'                 <div class="panel-body">                     <h4>'+X.lockUsername+"</h4>                     <p>"+X.lockMessage+'</p>                     <div class="input-group">                         <input id="jitp-lock-pass" type="text" class="form-control" placeholder="Password..."/>                         <span class="input-group-btn">                             <button id="jitp-lock-unlock" class="btn btn-primary" type="button">'+X.lockUnlockButton+'</button>                         </span>                     </div>                     <a id="jitp-lock-logout" href="javascript:;">'+o+"</a>                 </div>                 "+n+"            </div>            </div>"}function W(){var t=null!==X.lockTitle?"<header>"+X.lockTitle+"</header>":"",o=X.lockLogoutButton.replace(/{username}/g,X.lockUsername),n=X.lockCountdownMessage?"<footer>"+X.lockCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</footer>":"";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;">             <div class="jitp-lock-panel jitp-lock-jqpanel">                 '+t+'                 <div class="jitp-lock-jqpanel-body">                     <h2>'+X.lockUsername+"</h2>                     <p>"+X.lockMessage+'</p>                     <div>                         <input id="jitp-lock-pass" type="text" class="form-control" placeholder="Password..."/>                     </div>                     <button id="jitp-lock-unlock" type="button">'+X.lockUnlockButton+'</button>                     <a id="jitp-lock-logout" href="javascript:;">'+o+"</a>                 </div>                 "+n+"            </div>            </div>"}function H(){M(),Y()}function Q(){X.lockPassCallback($("#jitp-lock-pass").val())}function K(){a(),k(),M(),o("lockStartTime",-99)}function Y(){o("logoutTriggered",!0),K(),("function"!=typeof X.logoutCallback||X.logoutCallback(X))&&window.location.replace(X.logoutUrl)}function D(){K(),("function"!=typeof X.logoutAutoCallback||X.logoutAutoCallback(X))&&window.location.replace(X.logoutAutoUrl)}function N(){K(),("function"!=typeof X.redirectCallback||X.redirectCallback(X))&&window.location.replace(X.redirectUrl)}function O(t){var o=Math.floor(t/60);if(15>=o){var n=t%60,e=o>0?o+"m ":"";return e+=n+"s"}if(75>=o)return 22>=o?"about 15 mins":37>=o?"about 30 mins":52>=o?"about 25 mins":"about 1 hour";var l=Math.floor(o/60);return o%=60,15>=o||o>52?"about "+l+" hours":"about "+l+"&frac12; hours"}var X={idleTimeLimit:1200,idleCallback:!1,idleCheckHeartbeat:2,activityEvents:"click keypress scroll wheel mousewheel mousemove touchmove",bootstrap:!1,warnEnabled:!0,warnTimeLimit:180,warnCallback:!1,warnContentCallback:!1,warnTitle:"Session Timeout",warnMessage:"Your session is about to expire!",warnStayAliveButton:"Stay Connected",warnLogoutButton:"Logout",warnCountdownMessage:"Time remaining: {timer}",warnCountdownBar:!1,lockEnabled:!1,lockTimeLimit:7200,lockHaltKeepAlive:!0,lockCallback:!1,lockContentCallback:!1,lockPassCallback:!1,lockTitle:null,lockUsername:"System User",lockMessage:"Enter your password to unlock the screen",lockUnlockButton:"UnLock",lockLogoutButton:"Not {username} ?",lockCountdownMessage:"Auto-logout in: {timer}",lockBlockUiConfig:{},lockLoadActive:!1,redirectUrl:"/timed-out",redirectCallback:!1,logoutUrl:"/logout",logoutCallback:!1,logoutAutoUrl:"/logout-notice",logoutAutoCallback:!1,keepAliveInterval:600,keepAliveUrl:window.location.href,keepAliveAjaxType:"GET",keepAliveAjaxData:"",multiWindowSupport:!0},G=$("body"),J=null,z={};z.start=function(t){if(X=$.extend(X,t),X.idleTimeLimit*=1e3,X.idleCheckHeartbeat*=1e3,X.warnTimeLimit*=1e3,X.lockTimeLimit*=1e3,X.keepAliveInterval*=1e3,X.multiWindowSupport&&!$.localStorage)return console.error("jitp: Multi-Window support requested but JQuery Storage API is unavailable"),!1;if(X.warnEnabled&&X.warnCallback===!1||X.lockEnabled&&X.lockCallback===!1)if(X.bootstrap){if("undefined"==typeof $.fn.modal)return console.error("jitp: Bootstrap library is unavailable"),!1}else if("undefined"==typeof jQuery.ui)return console.error("jitp: jQueryUI library is unavailable"),!1;if(X.lockEnabled&&X.lockCallback===!1){if("undefined"==typeof $.blockUI)return console.error("jitp: Lock screen requested but blockUI library is unavailable"),!1;if(X.lockPassCallback===!1)return console.error("jitp: Lock screen requested but lockPassCallback function is not set"),!1}return J=X.multiWindowSupport?$.initNamespaceStorage("jqueryIdleTimeoutPlus").localStorage:{},X.lockEnabled&&(X.lockLoadActive||n("lockStartTime",-1)>0)?A():(o("logoutTriggered",!1),o("warningStartTime",-1),o("lockStartTime",-1),o("lastActivity",$.now()),l(),X.keepAliveInterval&&c()),X.keepAliveInterval&&c(),r(),!0},z.logout=function(){Y()},z.displayWarning=function(){v()},z.displayLockScreen=function(){I()},z.initLockScreen=function(){a(),k(),S()},z.rollback=function(){L(),d()};var F,R,V,Z,_=[-1,-1],tt=!0,ot=!1,nt=null,et=null,lt=null,at=!0,it=!1,rt=null,ct=null;return z});
!function(t,o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof exports?module.exports=o(require("jquery")):t.IdleTimeoutPlus=o(t.jQuery)}(this,function(t){function o(t,o){z.multiWindowSupport?Z.set(t,o):Z[t]=o}function n(t,o){if(o="undefined"!=typeof o?o:null,z.multiWindowSupport){if(Z.isSet(t))return Z.get(t)}else if(t in Z)return Z[t];return o}function e(){o("warningStartTime",-1),o("lockStartTime",-1),i(),z.idleCallback!==!1&&z.idleCallback(z)}function i(){l(),o("lastActivity",$.now()),tt=setInterval(a,z.idleCheckHeartbeat)}function l(){clearInterval(tt)}function a(){var t=n("lastActivity",$.now())+z.idleTimeLimit;return n("logoutTriggered")===!0?D():-1!=n("lockStartTime",-1)?(l(),A()):$.now()>=t?(l(),z.warnEnabled?s():z.lockEnabled?S():N()):void 0}function r(){$(document).on(z.activityEvents,function(t){if("mousemove"===t.type){if(t.clientX===it[0]&&t.clientY===it[1])return;it[0]=t.clientX,it[1]=t.clientY}-1==n("warningStartTime",-1)&&-1==n("lockStartTime",-1)&&i()})}function c(){u(),ot=setInterval(function(){$.ajax({type:z.keepAliveAjaxType,url:z.keepAliveUrl,data:z.keepAliveAjaxData})},z.keepAliveInterval)}function u(){clearInterval(ot)}function s(){p(),z.warnCallback!==!1&&(lt=z.warnCallback(z)),v()}function d(){k(),w(),o("warningStartTime",-1),e()}function p(){o("warningStartTime",$.now()),nt=setInterval(f,500)}function k(){clearInterval(nt)}function f(){if(n("logoutTriggered")===!0)return k(),D();if(-1==n("warningStartTime",-1))return d();var t=n("warningStartTime")+z.warnTimeLimit-1;return $.now()>=t?(k(),z.lockEnabled?(w(),S()):N()):void m()}function v(){lt&&(b(),m(),z.bootstrap?rt.modal("show"):rt.dialog("open"),at=!0)}function w(){at=!1,null!==rt&&(z.bootstrap?(rt.modal("hide"),V.removeClass("modal-open"),$("div.modal-backdrop").remove()):rt.dialog("close"))}function m(){if(null!==rt&&(null!==ct||null!==ut)){var t=$.now(),o=Math.floor((n("warningStartTime",t)+z.warnTimeLimit-t)/1e3);if(null!==ct&&ct.html(R(o)),null!=ut){var e=Math.floor(o/(z.warnTimeLimit/1e3)*100);z.bootstrap?ut.css("width",e+"%"):ut.progressbar("value",e)}}}function b(){if(null===rt){var t="";t=z.warnContentCallback!==!1?z.warnContentCallback(z):z.bootstrap?y():j(),z.bootstrap?g(t):h(t)}}function g(t){V.append(t),$("#jitp-warn-logout").on("click",function(){C()}),$("#jitp-warn-alive").on("click",function(){T()}),rt=$("#jitp-warn-display"),(0!=z.warnCountdownMessage||z.warnCountdownBar)&&(ct=rt.find(".jitp-countdown-holder")),z.warnCountdownBar&&(ut=$("#jitp-warn-bar"))}function h(t){$(t).dialog({buttons:[{text:z.warnLogoutButton,click:function(){C()}},{text:z.warnStayAliveButton,click:function(){T()}}],closeOnEscape:!1,modal:!0,title:z.warnTitle,minWidth:320,autoOpen:!1,open:function(){null==z.warnTitle?$(this).closest(".ui-dialog").find(".ui-dialog-titlebar").hide():$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide(),$(this).parent().find("button:nth-child(2)").focus()}}),rt=$("#jitp-warn-display"),0!=z.warnCountdownMessage&&(ct=rt.find(".jitp-countdown-holder")),z.warnCountdownBar&&(ut=$("#jitp-warn-bar"),ut.progressbar({value:0,max:100}))}function y(){var t=z.warnTitle?'<div class="modal-header"><h4 class="modal-title">'+z.warnTitle+"</h4></div>":"",o=z.warnCountdownMessage?"<p>"+z.warnCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>":"",n=z.warnCountdownBar?'<div class="progress">               <div id="jitp-warn-bar" class="progress-bar progress-bar-striped active" role="progressbar" style="min-width: 15px; width: 100%;">                 <span class="jitp-countdown-holder"></span>               </div>             </div>':"";return'<div class="modal fade" id="jitp-warn-display" data-backdrop="static" data-keyboard="false">                 <div class="modal-dialog">                     <div class="modal-content">                          '+t+'                         <div class="modal-body">                             <p>'+z.warnMessage+"</p>                             "+o+"                             "+n+'                         </div>                         <div class="modal-footer">                             <button id="jitp-warn-logout" type="button" class="btn btn-default">'+z.warnLogoutButton+'</button>                             <button id="jitp-warn-alive" type="button" class="btn btn-primary">'+z.warnStayAliveButton+"</button>                         </div>                     </div>                 </div>             </div>"}function j(){var t=z.warnCountdownMessage?"<p>"+z.warnCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>":"",o=z.warnCountdownBar?'<div id="jitp-warn-bar"></div>':"";return'<div id="jitp-warn-display"><p>'+z.warnMessage+"</p>"+t+o+"</div>"}function C(){k(),Y()}function T(){d()}function S(){z.lockHaltKeepAlive&&u(),L(),z.lockCallback!==!1&&(st=z.lockCallback(z)),B()}function A(){z.lockHaltKeepAlive?u():z.keepAliveInterval&&c(),-1==n("lockStartTime",-1)?L():et=setInterval(U,500),B()}function I(){M(),E(),z.keepAliveInterval&&c(),o("lockStartTime",-1),e()}function L(){o("lockStartTime",$.now()),et=setInterval(U,500)}function M(){clearInterval(et)}function U(){if(1==n("logoutTriggered"))return M(),D();if(-1==n("lockStartTime",-1))return I();var t=n("lockStartTime")+z.lockTimeLimit-1;return $.now()>=t?(M(),1==n("logoutTriggered")?D():N()):void x()}function B(){if(st){q(),x();var t={message:$("#jitp-lock-display")};t=$.extend(t,z.lockBlockUiConfig),$.blockUI(t),dt=!0}}function E(){$.unblockUI(),dt=!1}function x(){if(null!==kt){var t=$.now(),o=Math.floor((n("lockStartTime",t)+z.lockTimeLimit-t)/1e3);kt.html(R(o))}}function q(){if(null===pt){var t="";t=z.lockContentCallback!==!1?z.lockContentCallback(z):z.bootstrap?W():P(),V.append(t),pt=$("#jitp-lock-display"),0!=z.lockCountdownMessage&&(kt=pt.find(".jitp-countdown-holder")),$("#jitp-lock-logout").on("click",function(){H()}),$("#jitp-lock-unlock").on("click",function(){Q()}),$("#jitp-lock-form").length&&$("#jitp-lock-form").submit(function(){return Q(),!1}),x()}}function W(){var t=null!==z.lockTitle?'<div class="panel-heading"><h2 class="panel-title">'+z.lockTitle+"</h2></div>":"",o=z.lockLogoutButton.replace(/{username}/g,z.lockUsername),n=z.lockCountdownMessage?'<div class="panel-footer">'+z.lockCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder">BUBBA</span>')+"</div>":"";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;">             <div class="panel panel-default jitp-lock-panel">                 '+t+'                 <div class="panel-body">                     <h4>'+z.lockUsername+"</h4>                     <p>"+z.lockMessage+'</p>                     <div class="input-group">                         <input id="jitp-lock-pass" type="text" class="form-control" placeholder="Password..."/>                         <span class="input-group-btn">                             <button id="jitp-lock-unlock" class="btn btn-primary" type="button">'+z.lockUnlockButton+'</button>                         </span>                     </div>                     <a id="jitp-lock-logout" href="javascript:;">'+o+"</a>                 </div>                 "+n+"            </div>            </div>"}function P(){var t=null!==z.lockTitle?"<header>"+z.lockTitle+"</header>":"",o=z.lockLogoutButton.replace(/{username}/g,z.lockUsername),n=z.lockCountdownMessage?"<footer>"+z.lockCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</footer>":"";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;">             <div class="jitp-lock-panel jitp-lock-jqpanel">                 '+t+'                 <div class="jitp-lock-jqpanel-body">                     <h2>'+z.lockUsername+"</h2>                     <p>"+z.lockMessage+'</p>                     <div>                         <input id="jitp-lock-pass" type="text" class="form-control" placeholder="Password..."/>                     </div>                     <button id="jitp-lock-unlock" type="button">'+z.lockUnlockButton+'</button>                     <a id="jitp-lock-logout" href="javascript:;">'+o+"</a>                 </div>                 "+n+"            </div>            </div>"}function H(){M(),Y()}function Q(){z.lockPassCallback($("#jitp-lock-pass").val())}function K(){l(),k(),M(),o("lockStartTime",-99)}function Y(){o("logoutTriggered",!0),K(),("function"!=typeof z.logoutCallback||z.logoutCallback(z))&&window.location.replace(z.logoutUrl)}function D(){K(),("function"!=typeof z.logoutAutoCallback||z.logoutAutoCallback(z))&&window.location.replace(z.logoutAutoUrl)}function N(){K(),("function"!=typeof z.redirectCallback||z.redirectCallback(z))&&window.location.replace(z.redirectUrl)}function O(){o("activityEvents",z.activityEvents)}function X(){$(document).on("dialogopen shown.bs.modal",function(){at||dt||F()})}function F(){var t,o=function(){"complete"===document.readyState&&(clearInterval(t),G())};t=setInterval(o,1e3)}function G(t){t||(t=$(document));var o=0;t.find("iframe,frame").each(function(){if($(this).hasClass("jitp-inspected")===!1)try{G($(this).contents()),$(this).on("load",J($(this)));var t=$(this)[o];t.attachEvent&&t.attachEvent("onload",J($(this))),o++}catch(n){$(this).addClass("jitp-inspected cross-site")}})}function J(t){var o=t.contents(),e=n("activityEvents","");try{o.on(e,function(t){$("body").trigger(t)}),t.addClass("jitp-inspected")}catch(i){}}function R(t){var o=Math.floor(t/60);if(15>=o){var n=t%60,e=o>0?o+"m ":"";return e+=n+"s"}if(75>=o)return 22>=o?"about 15 mins":37>=o?"about 30 mins":52>=o?"about 25 mins":"about 1 hour";var i=Math.floor(o/60);return o%=60,15>=o||o>52?"about "+i+" hours":"about "+i+"&frac12; hours"}var z={idleTimeLimit:1200,idleCallback:!1,idleCheckHeartbeat:2,activityEvents:"click keypress scroll wheel mousewheel mousemove touchmove",bootstrap:!1,warnEnabled:!0,warnTimeLimit:180,warnCallback:!1,warnContentCallback:!1,warnTitle:"Session Timeout",warnMessage:"Your session is about to expire!",warnStayAliveButton:"Stay Connected",warnLogoutButton:"Logout",warnCountdownMessage:"Time remaining: {timer}",warnCountdownBar:!1,lockEnabled:!1,lockTimeLimit:7200,lockHaltKeepAlive:!0,lockCallback:!1,lockContentCallback:!1,lockPassCallback:!1,lockTitle:null,lockUsername:"System User",lockMessage:"Enter your password to unlock the screen",lockUnlockButton:"UnLock",lockLogoutButton:"Not {username} ?",lockCountdownMessage:"Auto-logout in: {timer}",lockBlockUiConfig:{},lockLoadActive:!1,redirectUrl:"/timed-out",redirectCallback:!1,logoutUrl:"/logout",logoutCallback:!1,logoutAutoUrl:"/logout-notice",logoutAutoCallback:!1,keepAliveInterval:600,keepAliveUrl:window.location.href,keepAliveAjaxType:"GET",keepAliveAjaxData:"",iframesSupport:!1,multiWindowSupport:!0},V=$("body"),Z=null,_={};_.start=function(t){if(z=$.extend(z,t),z.idleTimeLimit*=1e3,z.idleCheckHeartbeat*=1e3,z.warnTimeLimit*=1e3,z.lockTimeLimit*=1e3,z.keepAliveInterval*=1e3,z.multiWindowSupport&&!$.localStorage)return console.error("jitp: Multi-Window support requested but JQuery Storage API is unavailable"),!1;if(z.warnEnabled&&z.warnCallback===!1||z.lockEnabled&&z.lockCallback===!1)if(z.bootstrap){if("undefined"==typeof $.fn.modal)return console.error("jitp: Bootstrap library is unavailable"),!1}else if("undefined"==typeof jQuery.ui)return console.error("jitp: jQueryUI library is unavailable"),!1;if(z.lockEnabled&&z.lockCallback===!1){if("undefined"==typeof $.blockUI)return console.error("jitp: Lock screen requested but blockUI library is unavailable"),!1;if(z.lockPassCallback===!1)return console.error("jitp: Lock screen requested but lockPassCallback function is not set"),!1}return z.iframesSupport&&!z.multiWindowSupport?(console.error("jitp: IFrame support requested but Multi-Window support disabled"),!1):(Z=z.multiWindowSupport?$.initNamespaceStorage("jqueryIdleTimeoutPlus").localStorage:{},z.lockEnabled&&(z.lockLoadActive||n("lockStartTime",-1)>0)?A():(o("logoutTriggered",!1),o("warningStartTime",-1),o("lockStartTime",-1),o("lastActivity",$.now()),i(),z.keepAliveInterval&&c()),z.keepAliveInterval&&c(),O(),X(),r(),F(),!0)},_.logout=function(){Y()},_.displayWarning=function(){v()},_.displayLockScreen=function(){B()},_.initLockScreen=function(){l(),k(),S()},_.rollback=function(){I(),d()},_.iframeRecheck=function(){F()};var tt,ot,nt,et,it=[-1,-1],lt=!0,at=!1,rt=null,ct=null,ut=null,st=!0,dt=!1,pt=null,kt=null;return _});
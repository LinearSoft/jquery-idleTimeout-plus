!function(t,o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof exports?module.exports=o(require("jquery")):t.IdleTimeoutPlus=o(t.jQuery)}(this,function(t){function o(t,o){R.multiWindowSupport?V.set(t,o):V[t]=o}function n(t,o){if(o="undefined"!=typeof o?o:null,R.multiWindowSupport){if(V.isSet(t))return V.get(t)}else if(t in V)return V[t];return o}function e(){o("warningStartTime",-1),o("lockStartTime",-1),a(),R.idleCallback!==!1&&R.idleCallback(R)}function a(){i(),o("lastActivity",$.now()),_=setInterval(l,R.idleCheckHeartbeat)}function i(){clearInterval(_)}function l(){var t=n("lastActivity",$.now())+R.idleTimeLimit;return n("logoutTriggered")===!0?Y():$.now()>=t?(i(),R.warnEnabled?s():R.lockEnabled?S():D()):void 0}function r(){$(document).on(R.activityEvents,function(t){if("mousemove"===t.type){if(t.clientX===et[0]&&t.clientY===et[1])return;et[0]=t.clientX,et[1]=t.clientY}-1==n("warningStartTime",-1)&&-1==n("lockStartTime",-1)&&a()})}function c(){u(),tt=setInterval(function(){$.ajax({type:R.keepAliveAjaxType,url:R.keepAliveUrl,data:R.keepAliveAjaxData})},R.keepAliveInterval)}function u(){clearInterval(tt)}function s(){p(),R.warnCallback!==!1&&(at=R.warnCallback(R)),v()}function d(){k(),w(),o("warningStartTime",-1),e()}function p(){o("warningStartTime",$.now()),ot=setInterval(f,500)}function k(){clearInterval(ot)}function f(){if(n("logoutTriggered")===!0)return k(),Y();if(-1==n("warningStartTime",-1))return d();var t=n("warningStartTime")+R.warnTimeLimit-1;return $.now()>=t?(k(),R.lockEnabled?(w(),S()):D()):void b()}function v(){at&&(m(),b(),R.bootstrap?lt.modal("show"):lt.dialog("open"),it=!0)}function w(){it=!1,null!==lt&&(R.bootstrap?(lt.modal("hide"),z.removeClass("modal-open"),$("div.modal-backdrop").remove()):lt.dialog("close"))}function b(){if(null!==lt&&(null!==rt||null!==ct)){var t=$.now(),o=Math.floor((n("warningStartTime",t)+R.warnTimeLimit-t)/1e3);if(null!==rt&&rt.html(J(o)),null!=ct){var e=Math.floor(o/(R.warnTimeLimit/1e3)*100);R.bootstrap?ct.css("width",e+"%"):ct.progressbar("value",e)}}}function m(){if(null===lt){var t="";t=R.warnContentCallback!==!1?R.warnContentCallback(R):R.bootstrap?y():C(),R.bootstrap?g(t):h(t)}}function g(t){z.append(t),$("#jitp-warn-logout").on("click",function(){j()}),$("#jitp-warn-alive").on("click",function(){T()}),lt=$("#jitp-warn-display"),(0!=R.warnCountdownMessage||R.warnCountdownBar)&&(rt=lt.find(".jitp-countdown-holder")),R.warnCountdownBar&&(ct=$("#jitp-warn-bar"))}function h(t){$(t).dialog({buttons:[{text:R.warnLogoutButton,click:function(){j()}},{text:R.warnStayAliveButton,click:function(){T()}}],closeOnEscape:!1,modal:!0,title:R.warnTitle,minWidth:320,autoOpen:!1,open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide(),$(this).parent().find("button:nth-child(2)").focus()}}),lt=$("#jitp-warn-display"),0!=R.warnCountdownMessage&&(rt=lt.find(".jitp-countdown-holder")),R.warnCountdownBar&&(ct=$("#jitp-warn-bar"),ct.progressbar({value:0,max:100}))}function y(){var t=R.warnCountdownMessage?"<p>"+R.warnCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>":"",o=R.warnCountdownBar?'<div class="progress">               <div id="jitp-warn-bar" class="progress-bar progress-bar-striped active" role="progressbar" style="min-width: 15px; width: 100%;">                 <span class="jitp-countdown-holder"></span>               </div>             </div>':"";return'<div class="modal fade" id="jitp-warn-display" data-backdrop="static" data-keyboard="false">                 <div class="modal-dialog">                     <div class="modal-content">                         <div class="modal-header">                             <h4 class="modal-title">'+R.warnTitle+'</h4>                         </div>                         <div class="modal-body">                             <p>'+R.warnMessage+"</p>                             "+t+"                             "+o+'                         </div>                         <div class="modal-footer">                             <button id="jitp-warn-logout" type="button" class="btn btn-default">'+R.warnLogoutButton+'</button>                             <button id="jitp-warn-alive" type="button" class="btn btn-primary">'+R.warnStayAliveButton+"</button>                         </div>                     </div>                 </div>             </div>"}function C(){var t=R.warnCountdownMessage?"<p>"+R.warnCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>":"",o=R.warnCountdownBar?'<div id="jitp-warn-bar"></div>':"";return'<div id="jitp-warn-display"><p>'+R.warnMessage+"</p>"+t+o+"</div>"}function j(){k(),K()}function T(){d()}function S(){R.lockHaltKeepAlive&&u(),U(),R.lockCallback!==!1&&(ut=R.lockCallback(R)),L()}function A(){R.lockHaltKeepAlive&&u(),nt=setInterval(B,500),L()}function M(){I(),E(),R.keepAliveInterval&&c(),o("lockStartTime",-1),e()}function U(){o("lockStartTime",$.now()),nt=setInterval(B,500)}function I(){clearInterval(nt)}function B(){if(n("logoutTriggered")===!0)return I(),Y();if(-1==n("lockStartTime",-1))return M();var t=n("lockStartTime")+R.lockTimeLimit-1;return $.now()>=t?(I(),D()):void x()}function L(){if(ut){q(),x();var t={message:$("#jitp-lock-display")};t=$.extend(t,R.lockBlockUiConfig),$.blockUI(t),st=!0}}function E(){$.unblockUI(),st=!1}function x(){if(null!==pt){var t=$.now(),o=Math.floor((n("lockStartTime",t)+R.lockTimeLimit-t)/1e3);pt.html(J(o))}}function q(){if(null===dt){var t="";t=R.lockContentCallback!==!1?R.lockContentCallback(R):R.bootstrap?W():P(),z.append(t),dt=$("#jitp-lock-display"),0!=R.lockCountdownMessage&&(pt=dt.find(".jitp-countdown-holder")),$("#jitp-lock-logout").on("click",function(){H()}),$("#jitp-lock-unlock").on("click",function(){Q()}),x()}}function W(){var t=null!==R.lockTitle?'<div class="panel-heading"><h2 class="panel-title">'+R.lockTitle+"</h2></div>":"",o=R.lockLogoutButton.replace(/{username}/g,R.lockUsername),n=R.lockCountdownMessage?'<div class="panel-footer">'+R.lockCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder">BUBBA</span>')+"</div>":"";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;">             <div class="panel panel-default jitp-lock-panel">                 '+t+'                 <div class="panel-body">                     <h4>'+R.lockUsername+"</h4>                     <p>"+R.lockMessage+'</p>                     <div class="input-group">                         <input id="jitp-lock-pass" type="text" class="form-control" placeholder="Password..."/>                         <span class="input-group-btn">                             <button id="jitp-lock-unlock" class="btn btn-primary" type="button">'+R.lockUnlockButton+'</button>                         </span>                     </div>                     <a id="jitp-lock-logout" href="javascript:;">'+o+"</a>                 </div>                 "+n+"            </div>            </div>"}function P(){var t=null!==R.lockTitle?"<header>"+R.lockTitle+"</header>":"",o=R.lockLogoutButton.replace(/{username}/g,R.lockUsername),n=R.lockCountdownMessage?"<footer>"+R.lockCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</footer>":"";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;">             <div class="jitp-lock-panel jitp-lock-jqpanel">                 '+t+'                 <div class="jitp-lock-jqpanel-body">                     <h2>'+R.lockUsername+"</h2>                     <p>"+R.lockMessage+'</p>                     <div>                         <input id="jitp-lock-pass" type="text" class="form-control" placeholder="Password..."/>                     </div>                     <button id="jitp-lock-unlock" type="button">'+R.lockUnlockButton+'</button>                     <a id="jitp-lock-logout" href="javascript:;">'+o+"</a>                 </div>                 "+n+"            </div>            </div>"}function H(){I(),K()}function Q(){R.lockPassCallback($("#jitp-lock-pass").val())&&M()}function K(){o("logoutTriggered",!0),("function"!=typeof R.logoutCallback||R.logoutCallback(R))&&(window.location=R.logoutUrl)}function Y(){("function"!=typeof R.logoutAutoCallback||R.logoutAutoCallback(R))&&(window.location=R.logoutAutoUrl)}function D(){("function"!=typeof R.redirectCallback||R.redirectCallback(R))&&(window.location.href=R.redirectUrl)}function N(){o("activityEvents",R.activityEvents)}function O(){$(document).on("dialogopen shown.bs.modal",function(){it||st||X()})}function X(){var t,o=function(){"complete"===document.readyState&&(clearInterval(t),F())};t=setInterval(o,1e3)}function F(t){t||(t=$(document));var o=0;t.find("iframe,frame").each(function(){if($(this).hasClass("jitp-inspected")===!1)try{F($(this).contents()),$(this).on("load",G($(this)));var t=$(this)[o];t.attachEvent&&t.attachEvent("onload",G($(this))),o++}catch(n){$(this).addClass("jitp-inspected cross-site")}})}function G(t){var o=t.contents(),e=n("activityEvents","");try{o.on(e,function(t){$("body").trigger(t)}),t.addClass("jitp-inspected")}catch(a){}}function J(t){var o=Math.floor(t/60);if(15>=o){var n=t%60,e=o>0?o+"m ":"";return e+=n+"s"}if(75>=o)return 22>=o?"about 15 mins":37>=o?"about 30 mins":52>=o?"about 25 mins":"about 1 hour";var a=Math.floor(o/60);return o%=60,15>=o||o>52?"about "+a+" hours":"about "+a+"&frac12; hours"}var R={idleTimeLimit:1200,idleCallback:!1,idleCheckHeartbeat:2,activityEvents:"click keypress scroll wheel mousewheel mousemove touchmove",bootstrap:!1,warnEnabled:!0,warnTimeLimit:180,warnCallback:!1,warnContentCallback:!1,warnTitle:"Session Timeout",warnMessage:"Your session is about to expire!",warnStayAliveButton:"Stay Connected",warnLogoutButton:"Logout",warnCountdownMessage:"Time remaining: {timer}",warnCountdownBar:!1,lockEnabled:!1,lockTimeLimit:7200,lockHaltKeepAlive:!0,lockCallback:!1,lockContentCallback:!1,lockPassCallback:!1,lockTitle:null,lockUsername:"System User",lockMessage:"Enter your password to unlock the screen",lockUnlockButton:"UnLock",lockLogoutButton:"Not {username} ?",lockCountdownMessage:"Auto-logout in: {timer}",lockBlockUiConfig:{},redirectUrl:"/timed-out",redirectCallback:!1,logoutUrl:"/logout",logoutCallback:!1,logoutAutoUrl:"/logout-notice",logoutAutoCallback:!1,keepAliveInterval:600,keepAliveUrl:window.location.href,keepAliveAjaxType:"GET",keepAliveAjaxData:"",iframesSupport:!1,multiWindowSupport:!0},z=$("body"),V=null,Z={};Z.start=function(t){if(R=$.extend(R,t),R.idleTimeLimit*=1e3,R.idleCheckHeartbeat*=1e3,R.warnTimeLimit*=1e3,R.lockTimeLimit*=1e3,R.keepAliveInterval*=1e3,R.multiWindowSupport&&!$.localStorage)return console.error("jitp: Multi-Window support requested but JQuery Storage API is unavailable"),!1;if(R.warnEnabled&&R.warnCallback===!1||R.lockEnabled&&R.lockCallback===!1)if(R.bootstrap){if("undefined"==typeof $.fn.modal)return console.error("jitp: Bootstrap library is unavailable"),!1}else if("undefined"==typeof jQuery.ui)return console.error("jitp: jQueryUI library is unavailable"),!1;if(R.lockEnabled&&R.lockCallback===!1){if("undefined"==typeof $.blockUI)return console.error("jitp: Lock screen requested but blockUI library is unavailable"),!1;if(R.lockPassCallback===!1)return console.error("jitp: Lock screen requested but lockPassCallback function is not set"),!1}return R.iframesSupport&&!R.multiWindowSupport?(console.error("jitp: IFrame support requested but Multi-Window support disabled"),!1):(V=R.multiWindowSupport?$.initNamespaceStorage("jqueryIdleTimeoutPlus").localStorage:{},R.keepAliveInterval&&c(),N(),O(),r(),X(),R.lockEnabled&&-1!=n("lockStartTime",-1)?A():(o("logoutTriggered",!1),o("warningStartTime",-1),o("lockStartTime",-1),o("lastActivity",$.now()),a()),!0)},Z.logout=function(){K()},Z.displayWarning=function(){v()},Z.displayLockScreen=function(){L()},Z.rollback=function(){M(),d()},Z.iframeRecheck=function(){X()};var _,tt,ot,nt,et=[-1,-1],at=!0,it=!1,lt=null,rt=null,ct=null,ut=!0,st=!1,dt=null,pt=null;return Z});